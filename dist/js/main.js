(()=>{"use strict";var e=Object.defineProperty,t=(t,r,n)=>(((t,r,n)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n})(t,"symbol"!=typeof r?r+"":r,n),n);new class{constructor(){t(this,"handleDragStart",(e=>{e.currentTarget.style.opacity="0.4",this.dragSrcEl=e.currentTarget,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.dragSrcEl)})),t(this,"handleDragEnd",(e=>{e.currentTarget.style.opacity="1";const t=document.querySelectorAll(".js-omf-repeat-field");t.length&&t.forEach((e=>{e.classList.remove("over")}))})),t(this,"handleDragOver",(e=>(e.preventDefault&&e.preventDefault(),!1))),t(this,"handleDragEnter",(e=>{e.currentTarget.classList.add("over")})),t(this,"handleDragLeave",(e=>{e.currentTarget.classList.remove("over")})),t(this,"handleDrop",(e=>{if(e.stopPropagation(),this.dragSrcEl!==e.currentTarget){const t=Number(this.dragSrcEl.dataset.omfValidationCount)<Number(e.currentTarget.dataset.omfValidationCount)?"afterend":"beforebegin";e.currentTarget.insertAdjacentElement(t,this.dragSrcEl);this.updateFieldIndex()}return!1})),this.repeatField()}repeatField(){this.repeatCount=this.getRepeatFieldCount(),this.addRepeatFieldEvent(),this.removeRepeatFieldEvent(),this.toggleFieldEvent(),this.changeTitleEvent(),this.dragEvent()}getRepeatFieldCount(){let e=1;const t=document.querySelectorAll(".js-omf-repeat-field");if(!t.length)return e;const r=t[t.length-1].dataset.omfValidationCount;return e=r?Number(r)+1:e,e}removeRepeatFieldEvent(){const e=document.querySelectorAll(".js-omf-remove");if(e.length)for(const t of e)this.addRemoveEvent(t)}addRemoveEvent(e){e&&e.addEventListener("click",(e=>{e.preventDefault(),this.repeatCount>1&&this.removeRepeatField(e)}),!1)}removeRepeatField(e){const t=e.currentTarget.closest(".js-omf-repeat-field");t&&(t.remove(),this.repeatCount=this.getRepeatFieldCount(),this.repeatCount)}addRepeatFieldEvent(){const e=document.querySelector("#js-omf-repeat-add-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),this.addRepeatField(e)}),!1)}addRepeatField(e){const t=document.querySelectorAll(".js-omf-repeat-field");if(!t.length)return;const r=t[t.length-1],n=r.cloneNode(!0),a=r.insertAdjacentElement("afterend",n),l=a.querySelectorAll('[name^="cf_omf_validation"]');let o=0;for(const e of l)e.name=this.replaceBracketsWithText(e.name,this.repeatCount),e.value=1==e.value?1:"",e.setAttribute("value",e.value),e.checked=!1,e.removeAttribute("checked"),o===l.length-1&&(this.repeatCount=this.extractBracketContents(e.name)+1),o++;const d=a.querySelector(".js-omf-field-title");d&&(d.textContent=""),this.addChangeTitleEvent(a.querySelector(".js-omf-input-field-title")),this.addRemoveEvent(a.querySelector(".js-omf-remove")),this.addToggleFieldEvent(a.querySelector(".js-omf-toggle")),this.addDragEvent(a)}replaceBracketsWithText(e,t){return e.replace(/(cf_omf_validation\[)(\d+)(\])/g,`$1${t}$3`)}extractBracketContents(e){const t=e.match(/cf_omf_validation\[(\d+)\]/);return t?Number(t[1]):null}toggleFieldEvent(){const e=document.querySelectorAll(".js-omf-toggle");if(e.length)for(const t of e)this.addToggleFieldEvent(t)}addToggleFieldEvent(e){e&&e.addEventListener("click",(e=>{e.preventDefault(),this.toggleField(e)}),!1)}toggleField(e){const t=e.currentTarget.closest(".js-omf-repeat-field");if(!t)return;const r=t.querySelector(".js-omf-toggle-field");r&&(r.classList.contains("open")?r.classList.remove("open"):r.classList.add("open"))}changeTitleEvent(){const e=document.querySelectorAll(".js-omf-input-field-title");if(e.length)for(const t of e)this.addChangeTitleEvent(t)}addChangeTitleEvent(e){e&&(e.addEventListener("input",(e=>{e.preventDefault(),this.changeTitle(e)}),!1),e.addEventListener("blur",(e=>{e.currentTarget.setAttribute("value",e.currentTarget.value)}),!1))}changeTitle(e){const t=e.currentTarget,r=t.closest(".js-omf-repeat-field");if(!r)return;const n=r.querySelector(".js-omf-field-title");n&&(n.textContent=t.value)}dragEvent(){const e=document.querySelectorAll(".js-omf-repeat-field");e.length&&(this.dragSrcEl=null,e.forEach((e=>{this.addDragEvent(e)})))}addDragEvent(e){e.addEventListener("dragstart",this.handleDragStart),e.addEventListener("dragover",this.handleDragOver),e.addEventListener("dragenter",this.handleDragEnter),e.addEventListener("dragleave",this.handleDragLeave),e.addEventListener("dragend",this.handleDragEnd),e.addEventListener("drop",this.handleDrop)}updateFieldIndex(){const e=document.querySelectorAll(".js-omf-repeat-field");if(!e.length)return fieldCount;let t=0;for(const r of e){r.dataset.omfValidationCount=t;const e=r.querySelectorAll('[name^="cf_omf_validation"]');for(const r of e)r.name=this.replaceBracketsWithText(r.name,t);t++}}}})();
//# sourceMappingURL=main.js.map